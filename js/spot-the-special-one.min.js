var XMing=XMing||{};XMing.GameStateManager=new function(){var i,a,e,t=0,l=[{available:["i"],special:"l"},{available:["O"],special:"0"},{available:["0"],special:"O"},{available:["5"],special:"S"},{available:["p"],special:"q"},{available:["8"],special:"3"},{available:["m"],special:"nn"},{available:["w"],special:"vv"},{available:["u"],special:"&#xB5;"},{available:["x"],special:"&#10008;"},{available:["d"],special:"cl"},{available:["O"],special:"Q"},{available:["3","6","8","9","0"],special:"S"},{available:["a","e","i","o","u"],special:"n"},{available:["v","w","x","y","z"],special:"u"},{available:["V","W","X","Y"],special:"M"}],n=_.range(_.size(l)),s={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),!1),this.initGame()},this.loadData=function(){var i=this,s=_.sample(n);n=_.without(n,s);var c=l[s],o=Math.ceil(15/_.size(c.available)),d=[];_.times(o,function(){d=d.concat(c.available)}),d=_.sample(d,15);var r=[];_.each(d,function(i){r.push("<li><div class='content animated fadeIn'>"+i+"</div></li>")}),r.push("<li><div class='content animated fadeIn' data-special='true'>"+c.special+"</div></li>"),r=_.shuffle(r),$(".game-grid").html(""),_.each(r,function(i){$(".game-grid").append(i)}),this.onResize(),$("html, body").scrollTop($("#panel-container").offset().top),e=3.5,function v(){e-=.5,$("#timer-value").html(Math.ceil(e)),$("#timer-value").addClass("animated fadeIn"),$("#score-value").html(t),0>=e?(clearTimeout(a),$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)"),$("#timer-value").removeClass("animated fadeIn"),i.loadNextRound()):a=setTimeout(v,500)}(),$("ul.game-grid li").click(function(){$(this.firstChild).data("special")?($("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)"),t+=10*e,$(".score-change").html("+"+10*e).css("color","rgba(0, 255, 0, 255)")):($("#result-content").html("Wrong!").addClass("animated bounceIn").css("color","rgba(255, 0, 0, 255)"),t-=10*e,$(".score-change").html("-"+10*e).css("color","rgba(255, 0, 0, 255)")),$("#timer-value").removeClass("animated fadeIn"),$("#score-value").html(t),$(".score-change").animate({top:"-25px"},{duration:1e3,complete:function(){$(".score-change").html("").css("top","-10px")}}),clearTimeout(a),i.loadNextRound()})},this.loadNextRound=function(){var i=this,a=$("ul.game-grid");$("#result").width(a.width()).height(a.height()).show(),_.delay(function(){$("#result").hide(),_.size(n)>0?i.loadData():i.endGame()},1e3)},this.onResize=function(){var i=$(".game-grid").children("li"),a=_.max(i,function(i){return $(i).width()}),e=$(a).width();_.each(i,function(i){$(i).height(e)})},this.initGame=function(){i=s.INITIAL;var a=this;$(".icon-repeat").click(function(){a.startGame()})},this.startGame=function(){i=s.START,t=0,n=_.range(_.size(l)),$("#timer").show(),$("#replay").hide(),this.loadData()},this.endGame=function(){i=s.END;var a="<li><div class='content'>#</div></li>";a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>G</div></li>",a+="<li><div class='content'>A</div></li>",a+="<li><div class='content'>M</div></li>",a+="<li><div class='content'>E</div></li>",a+="<li><div class='content'>O</div></li>",a+="<li><div class='content'>V</div></li>",a+="<li><div class='content'>E</div></li>",a+="<li><div class='content'>R</div></li>",a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>#</div></li>",a+="<li><div class='content'>#</div></li>",$(".game-grid").html(a),$("#timer").hide(),$("#replay").show(),$("#score-value").html(t),this.onResize(),$("html, body").scrollTop($("#panel-container").offset().top),alert("Congratulations!\rYour score is "+t+"!\rThanks for playing!")},this.isGameStateInitial=function(){return i==s.INITIAL},this.isGameStateStart=function(){return i==s.START},this.isGameStateEnd=function(){return i==s.END}};